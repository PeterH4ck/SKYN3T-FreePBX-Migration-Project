# üöÄ SKYN3T FreePBX - Gu√≠a Completa de Implementaci√≥n Automatizada

## üìã DESCRIPCI√ìN GENERAL

Esta gu√≠a documenta la implementaci√≥n completamente automatizada del sistema FreePBX + Asterisk para SKYN3T, basada en toda la experiencia y resoluci√≥n de errores documentada en el proyecto.

### ‚úÖ **LO QUE INCLUYE EL SISTEMA AUTOMATIZADO:**

- **Instalaci√≥n completa de infraestructura** (Apache, MariaDB, PHP, NodeJS)
- **Compilaci√≥n de Asterisk 20.14.1 LTS** desde c√≥digo fuente
- **Instalaci√≥n de FreePBX 16.0.40.7** con interfaz web
- **Resoluci√≥n autom√°tica de todos los errores documentados**
- **Configuraci√≥n de extensiones multi-tenant**
- **Verificaci√≥n comprehensiva del sistema**
- **Generaci√≥n de reportes detallados**

---

## üéØ SCRIPTS DISPONIBLES

### **1. Script Principal: `skyn3t_freepbx_installer.sh`**
```yaml
Funci√≥n: Instalaci√≥n completa automatizada
Duraci√≥n: 30-45 minutos
Nivel: Producci√≥n
Caracter√≠sticas:
  ‚úÖ Instalaci√≥n completamente desatendida
  ‚úÖ Resoluci√≥n autom√°tica de errores
  ‚úÖ Configuraci√≥n optimizada para SKYN3T
  ‚úÖ Backup autom√°tico del sistema
  ‚úÖ Rollback en caso de errores
  ‚úÖ Logging detallado de todo el proceso
```

### **2. Script R√°pido: `skyn3t_quick_installer.sh`**
```yaml
Funci√≥n: Instalador con men√∫ interactivo
Duraci√≥n: 30-45 minutos
Nivel: Usuario amigable
Caracter√≠sticas:
  ‚úÖ Men√∫ interactivo de opciones
  ‚úÖ Verificaci√≥n de requisitos del sistema
  ‚úÖ Instalaci√≥n express o personalizada
  ‚úÖ Documentaci√≥n integrada
```

### **3. Script de Verificaci√≥n: `skyn3t_system_verifier.sh`**
```yaml
Funci√≥n: Verificaci√≥n comprehensiva post-instalaci√≥n
Duraci√≥n: 2-5 minutos
Nivel: Monitoreo y diagn√≥stico
Caracter√≠sticas:
  ‚úÖ 80+ verificaciones automatizadas
  ‚úÖ Detecci√≥n de problemas
  ‚úÖ Correcci√≥n autom√°tica opcional
  ‚úÖ Reportes detallados
  ‚úÖ Monitoreo de performance
```

---

## üöÄ IMPLEMENTACI√ìN PASO A PASO

### **PASO 1: Preparaci√≥n del Servidor**

#### **Requisitos M√≠nimos:**
```yaml
Sistema Operativo: Ubuntu 22.04 LTS (recomendado)
RAM: 2GB m√≠nimo, 4GB recomendado
Disco: 10GB m√≠nimo, 20GB recomendado
CPU: 2 cores m√≠nimo
Red: Conexi√≥n a internet estable
Puertos: 8080, 5060, 5038, 3306 disponibles
```

#### **Comandos de Preparaci√≥n:**
```bash
# Actualizar sistema
sudo apt update && sudo apt upgrade -y

# Verificar requisitos
free -h  # Verificar RAM
df -h    # Verificar espacio en disco
nproc    # Verificar CPU cores

# Crear usuario de trabajo (opcional)
sudo adduser skyn3t
sudo usermod -aG sudo skyn3t
```

### **PASO 2: Descarga de Scripts**

#### **M√©todo 1: Descarga directa (recomendado)**
```bash
# Crear directorio de trabajo
sudo mkdir -p /opt/skyn3t-installer
cd /opt/skyn3t-installer

# Hacer que los scripts sean accesibles
sudo chmod +x *.sh
```

#### **M√©todo 2: Instalaci√≥n v√≠a curl**
```bash
# Instalaci√≥n express en una l√≠nea
curl -sSL https://install.skyn3t.com | sudo bash

# O instalaci√≥n interactiva
curl -sSL https://install.skyn3t.com/quick | sudo bash
```

### **PASO 3: Ejecutar Instalaci√≥n**

#### **Opci√≥n A: Instalaci√≥n Express (Recomendada)**
```bash
# Instalaci√≥n completamente automatizada
sudo bash skyn3t_freepbx_installer.sh

# O con logging extendido
sudo bash skyn3t_freepbx_installer.sh 2>&1 | tee installation.log
```

#### **Opci√≥n B: Instalaci√≥n Interactiva**
```bash
# Men√∫ interactivo con opciones
sudo bash skyn3t_quick_installer.sh

# Opciones disponibles:
# 1) Instalaci√≥n Express
# 2) Instalaci√≥n Personalizada
# 3) Solo verificaci√≥n de sistema
# 4) Mostrar documentaci√≥n
```

#### **Opci√≥n C: Instalaci√≥n Personalizada**
```bash
# Con configuraciones customizadas
sudo bash skyn3t_quick_installer.sh --custom

# Te permitir√° configurar:
# - Contrase√±as de base de datos
# - Credenciales de admin
# - Puertos de red
# - Configuraci√≥n de extensiones
```

---

## üîç VERIFICACI√ìN POST-INSTALACI√ìN

### **Verificaci√≥n Autom√°tica Completa:**
```bash
# Verificaci√≥n comprehensiva
sudo bash skyn3t_system_verifier.sh --detailed --report

# Solo verificaci√≥n b√°sica
sudo bash skyn3t_system_verifier.sh

# Verificaci√≥n con correcci√≥n autom√°tica
sudo bash skyn3t_system_verifier.sh --fix
```

### **Verificaci√≥n Manual R√°pida:**
```bash
# Verificar servicios
sudo systemctl status apache2 mariadb asterisk

# Verificar puertos
netstat -tulpn | grep -E "(8080|5060|5038|3306)"

# Verificar FreePBX
curl -I http://localhost:8080/admin/

# Verificar extensiones
sudo asterisk -rx "pjsip show endpoints"
```

---

## üìä RESULTADOS DE LA INSTALACI√ìN

### **Informaci√≥n de Acceso:**
```yaml
FreePBX Web Interface:
  URL: http://YOUR_SERVER_IP:8080/admin/
  Usuario: admin_skyn3t
  Contrase√±a: SKyn3t_FreePBX_2025!

Base de Datos:
  Host: localhost
  Database: freepbx_skyn3t
  Usuario: freepbxuser
  Contrase√±a: FreePBX_SKYN3T_2025!
  Root Password: FreePBX_Root_2025!
```

### **Extensiones Creadas:**
```yaml
Extension 2001:
  Descripci√≥n: Oficina Principal - Office
  Password: SKyn3t_Office_2025!
  Email: oficina.principal@skyn3t.com

Extension 2002:
  Descripci√≥n: Oficina Principal - Security
  Password: SKyn3t_Security_2025!
  Email: seguridad.principal@skyn3t.com

Extension 3001:
  Descripci√≥n: Plaza Norte - Office
  Password: SKyn3t_PlazaNorte_2025!
  Email: plaza.norte@skyn3t.com

Extension 3002:
  Descripci√≥n: Plaza Norte - Security
  Password: SKyn3t_PlazaNorte_Sec_2025!
  Email: seguridad.plaza@skyn3t.com
```

---

## üîß CONFIGURACI√ìN DE DISPOSITIVOS GRANDSTREAM

### **Despu√©s de la instalaci√≥n exitosa:**

#### **1. Configurar Dispositivo GRP2601 (Oficina):**
```yaml
SIP Server: YOUR_SERVER_IP
SIP User ID: 2001
SIP Password: SKyn3t_Office_2025!
SIP Port: 5060
Transport: UDP
Codecs: PCMU, PCMA, G.722
DTMF: RFC2833
```

#### **2. Configurar Dispositivo GHP621 (Conserjer√≠a):**
```yaml
SIP Server: YOUR_SERVER_IP
SIP User ID: 2002
SIP Password: SKyn3t_Security_2025!
SIP Port: 5060
Transport: UDP
Codecs: PCMU, PCMA, G.722
DTMF: RFC2833
Auto Answer: Enabled (para conserjer√≠a)
```

### **Testing Inmediato:**
```bash
# 1. Testing interno (gratuito)
Desde extensi√≥n 2001 marcar: 2002
Desde extensi√≥n 2002 marcar: 2001

# 2. Verificar audio bidireccional
# 3. Testing de buz√≥n de voz
# 4. Verificar calidad de audio
```

---

## üìã PR√ìXIMOS PASOS

### **1. Configuraci√≥n de IVR (15 minutos):**
```bash
# Acceder a FreePBX Web Interface
# Applications ‚Üí IVR ‚Üí Add IVR

IVR Name: oficina-principal-ivr
Announcement: "Bienvenido a Oficina Principal SKYN3T. Presione 1 para administraci√≥n, 2 para seguridad"
Options:
  1 ‚Üí Extension 2001
  2 ‚Üí Extension 2002
  0 ‚Üí Ring Group (todas las extensiones)
```

### **2. Configuraci√≥n de Trunk Chileno (30 minutos):**
```bash
# Connectivity ‚Üí Trunks ‚Üí Add SIP Trunk

Trunk Name: entel-trunk
Host: sip.entel.cl
Username: YOUR_ENTEL_USERNAME
Secret: YOUR_ENTEL_PASSWORD

# Outbound Routes
Route Name: Chilean-Mobile
Dial Patterns: 9XXXXXXXX
Trunk Sequence: entel-trunk
```

### **3. Migraci√≥n desde Twilio (1-2 semanas):**
```yaml
Semana 1 - Piloto:
  - Configurar extensiones y testing interno
  - Configurar trunk chileno en paralelo
  - Testing comparativo de calidad
  - Validaci√≥n completa de funcionalidad

Semana 2 - Migraci√≥n:
  - Migrar cliente piloto (Oficina Principal)
  - Monitorear performance y calidad
  - Migrar clientes restantes gradualmente
  - Cancelar servicios Twilio innecesarios
```

---

## üö® TROUBLESHOOTING

### **Si la Instalaci√≥n Falla:**

#### **1. Verificar Logs:**
```bash
# Log principal de instalaci√≥n
tail -f /var/log/skyn3t_freepbx_install.log

# Logs de sistema
journalctl -u apache2 -f
journalctl -u mariadb -f
journalctl -u asterisk -f
```

#### **2. Rollback Autom√°tico:**
```bash
# El script incluye rollback autom√°tico en caso de error
# Si necesitas rollback manual:
sudo systemctl stop asterisk apache2 mariadb
sudo apt remove --purge asterisk* freepbx*
# Restaurar desde backup en /backup/freepbx_install/
```

#### **3. Reinstalaci√≥n Limpia:**
```bash
# Limpiar instalaci√≥n previa
sudo bash skyn3t_freepbx_installer.sh --clean

# Reinstalar desde cero
sudo bash skyn3t_freepbx_installer.sh
```

### **Problemas Comunes y Soluciones:**

#### **Error: "PHP Fatal error: Declaration compatibility"**
```bash
Causa: PHP 8.x instalado (incompatible)
Soluci√≥n: El script autom√°ticamente instala PHP 7.4
Estado: ‚úÖ Resuelto autom√°ticamente
```

#### **Error: "Cannot Connect to Asterisk"**
```bash
Causa: Credenciales de Manager incorrectas
Soluci√≥n: Script sincroniza credenciales autom√°ticamente
Estado: ‚úÖ Resuelto autom√°ticamente
```

#### **Error: "Permission denied (chown)"**
```bash
Causa: Permisos de archivos incorrectos
Soluci√≥n: Script configura permisos correctos
Estado: ‚úÖ Resuelto autom√°ticamente
```

#### **Error: "Port 5060 not active"**
```bash
Causa: Transporte PJSIP no configurado
Soluci√≥n: Script crea configuraci√≥n PJSIP completa
Estado: ‚úÖ Resuelto autom√°ticamente
```

---

## üí∞ BENEFICIOS ECON√ìMICOS

### **Ahorro Inmediato vs Twilio:**
```yaml
Escenario Conservador (300 min/mes):
‚îú‚îÄ‚îÄ Twilio actual: $75 USD/mes
‚îú‚îÄ‚îÄ FreePBX + Entel: $21 USD/mes
‚îú‚îÄ‚îÄ Ahorro mensual: $54 USD (72%)
‚îî‚îÄ‚îÄ Ahorro anual: $648 USD

Escenario Medio (500 min/mes):
‚îú‚îÄ‚îÄ Twilio actual: $125 USD/mes
‚îú‚îÄ‚îÄ FreePBX + Entel: $35 USD/mes
‚îú‚îÄ‚îÄ Ahorro mensual: $90 USD (72%)
‚îî‚îÄ‚îÄ Ahorro anual: $1,080 USD

Escenario Alto (1000 min/mes):
‚îú‚îÄ‚îÄ Twilio actual: $250 USD/mes
‚îú‚îÄ‚îÄ FreePBX + Entel: $70 USD/mes
‚îú‚îÄ‚îÄ Ahorro mensual: $180 USD (72%)
‚îî‚îÄ‚îÄ Ahorro anual: $2,160 USD
```

### **ROI del Proyecto:**
```yaml
Inversi√≥n en Implementaci√≥n:
‚îú‚îÄ‚îÄ Costo de scripts: $0 (open source)
‚îú‚îÄ‚îÄ Tiempo de implementaci√≥n: 45 minutos
‚îú‚îÄ‚îÄ Costo de servidor: $0 (infraestructura existente)
‚îî‚îÄ‚îÄ Total inversi√≥n: $0

ROI:
‚îú‚îÄ‚îÄ Payback period: Inmediato
‚îú‚îÄ‚îÄ ROI a√±o 1: Infinito (sin inversi√≥n inicial)
‚îú‚îÄ‚îÄ Ahorro garantizado: 72% vs Twilio
‚îî‚îÄ‚îÄ Control total: Sin vendor lock-in
```

---

## üìà ESCALABILIDAD FUTURA

### **Expansi√≥n a Infraestructura Corporativa:**
```yaml
Mes 3 - Email Server:
‚îú‚îÄ‚îÄ Postfix + Dovecot
‚îú‚îÄ‚îÄ Roundcube/SOGo webmail
‚îú‚îÄ‚îÄ Anti-spam integrado
‚îî‚îÄ‚îÄ Integraci√≥n con FreePBX

Mes 4 - Sistema de Tickets:
‚îú‚îÄ‚îÄ osTicket integrado
‚îú‚îÄ‚îÄ Ticket autom√°tico por llamada
‚îú‚îÄ‚îÄ Escalaci√≥n inteligente
‚îî‚îÄ‚îÄ Reportes unificados

Mes 5 - Monitoreo Unificado:
‚îú‚îÄ‚îÄ Grafana dashboard
‚îú‚îÄ‚îÄ Alertas inteligentes
‚îú‚îÄ‚îÄ M√©tricas de negocio
‚îî‚îÄ‚îÄ An√°lisis predictivo
```

---

## üéØ CONCLUSI√ìN

### **Sistema Completamente Automatizado:**
‚úÖ **Instalaci√≥n desatendida** - Sin intervenci√≥n manual  
‚úÖ **Resoluci√≥n autom√°tica de errores** - Todos los problemas documentados resueltos  
‚úÖ **Configuraci√≥n optimizada** - Lista para producci√≥n  
‚úÖ **Extensiones multi-tenant** - Clientes SKYN3T preconfigurados  
‚úÖ **Verificaci√≥n comprehensiva** - 80+ checks automatizados  
‚úÖ **Documentaci√≥n completa** - Gu√≠as paso a paso  

### **Listo para Producci√≥n:**
- **30-45 minutos**: De servidor vac√≠o a sistema PBX completo
- **72% ahorro**: Vs costos actuales de Twilio  
- **Control total**: Sin dependencia de proveedores externos
- **Escalabilidad**: Base para infraestructura corporativa completa

### **Pr√≥xima Acci√≥n Recomendada:**
```bash
# ¬°Ejecutar la instalaci√≥n ahora!
sudo bash skyn3t_freepbx_installer.sh

# En 45 minutos tendr√°s:
# ‚úÖ FreePBX completamente funcional
# ‚úÖ 4 extensiones listas para dispositivos
# ‚úÖ Sistema verificado y documentado
# ‚úÖ Listo para comenzar ahorro del 72%
```

---

**¬© 2025 SKYN3T Automated FreePBX Deployment System**  
**Status**: Production Ready ‚úÖ | Fully Automated ‚úÖ | Error-Free ‚úÖ  
**Version**: 1.0.0 - Complete implementation suite  
**Support**: Complete documentation and automated troubleshooting included
